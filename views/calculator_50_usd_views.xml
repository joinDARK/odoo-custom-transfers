<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Форма для калькулятора -->
    <record id="calculator_50_usd_form_view" model="ir.ui.view">
        <field name="name">amanat.calculator.50.usd.wizard.form</field>
        <field name="model">amanat.calculator.50.usd.wizard</field>
        <field name="arch" type="xml">
            <form string="Калькулятор сделок" class="calculator-form-background" create="false" edit="true">
                <sheet style="background: rgba(255, 255, 255, 0.95) !important; border-radius: 10px !important; padding: 20px !important; margin: 10px !important; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1) !important;">
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="Название расчета..." readonly="1"/>
                        </h1>
                    </div>

                    <group string="Основные параметры">
                        <group>
                            <field name="date"/>
                            <field name="deal_variant"/>
                        </group>
                    </group>

                    <group string="Настройки кросс-курса" invisible="deal_variant not in ('eur_cross','cny_cross')" colspan="4">
                        <group>
                            <field name="auto_markup_percent"/>
                        </group>
                    </group>

                    <!-- EUR (кросс) -->
                    <group string="Расчеты EUR (кросс-курс)" invisible="deal_variant != 'eur_cross'" colspan="4">
                        <group string="Исходные данные">
                            <field name="eur_invoice_amount"/>
                            <field name="usd_rate_cbr" digits="[16,6]"/>
                            <field name="eur_xe_rate" digits="[16,6]"/>
                            <field name="auto_markup_percent" readonly="1"/>
                        </group>
                        <group string="Результаты расчетов">
                            <field name="eur_cross_client" readonly="1" digits="[16,6]"/>
                            <field name="eur_amount_rub" readonly="1" digits="[16,2]"/>
                            <field name="eur_commission_percent"/>
                            <field name="eur_commission_amount" readonly="1" digits="[16,2]"/>
                            <field name="eur_total_rub" readonly="1" digits="[16,2]"/>
                            <field name="eur_to_rub_rate" readonly="1" digits="[16,6]"/>
                        </group>
                    </group>

                    <!-- CNY (кросс) -->
                    <group string="Расчеты CNY (кросс-курс)" invisible="deal_variant != 'cny_cross'" colspan="4">
                        <group string="Исходные данные">
                            <field name="cny_invoice_amount"/>
                            <field name="usd_rate_investing_cny_cross" digits="[16,6]"/>
                            <field name="cny_cross" digits="[16,6]"/>
                            <field name="auto_markup_percent" readonly="1"/>
                        </group>
                        <group string="Результаты расчетов">
                            <field name="cny_cross_client" readonly="1" digits="[16,6]"/>
                            <field name="cny_amount_rub" readonly="1" digits="[16,2]"/>
                            <field name="cny_commission_percent"/>
                            <field name="cny_commission_amount" readonly="1" digits="[16,2]"/>
                            <field name="cny_total_rub" readonly="1" digits="[16,2]"/>
                            <field name="cny_to_rub_rate" readonly="1" digits="[16,6]"/>
                        </group>
                    </group>

                    <!-- USD (обычный) -->
                    <group string="Расчеты USD (с добавкой)" invisible="deal_variant != 'usd_addon'" colspan="4">
                        <group string="Исходные данные">
                            <field name="usd_invoice_amount"/>
                            <field name="usd_investing_rate" digits="[16,6]"/>
                            <field name="usd_commission_percent"/>
                        </group>
                        <group string="Результаты расчетов">
                            <field name="usd_final_rate_for_payment" readonly="1" digits="[16,6]"/>
                            <field name="usd_payment_amount_rub" readonly="1" digits="[16,2]"/>
                            <field name="usd_addon_usd"/>
                            <field name="usd_addon_amount_rub" readonly="1" digits="[16,2]"/>
                            <field name="usd_total_rub" readonly="1" digits="[16,2]"/>
                            <field name="usd_final_rate_incl_addon" readonly="1" digits="[16,6]"/>
                        </group>
                    </group>

                    <!-- CNY (обычный) -->
                    <group string="Расчеты CNY (с добавкой)" invisible="deal_variant != 'cny_addon'" colspan="4">
                        <group string="Исходные данные">
                            <field name="cny2_invoice_amount"/>
                            <field name="cny2_rate" digits="[16,6]"/>
                            <field name="cny2_commission_percent"/>
                            <field name="cny2_usd_rate" digits="[16,6]"/>
                        </group>
                        <group string="Результаты расчетов">
                            <field name="cny2_final_rate_for_payment" readonly="1" digits="[16,6]"/>
                            <field name="cny2_payment_amount_rub" readonly="1" digits="[16,2]"/>
                            <field name="cny2_addon_usd"/>
                            <field name="cny2_addon_amount_rub" readonly="1" digits="[16,2]"/>
                            <field name="cny2_total_rub" readonly="1" digits="[16,2]"/>
                            <field name="cny2_final_rate_incl_addon" readonly="1" digits="[16,6]"/>
                        </group>
                    </group>

                    <!-- EUR (обычный) -->
                    <group string="Расчеты EUR (с добавкой)" invisible="deal_variant != 'eur_addon'" colspan="4">
                        <group string="Исходные данные">
                            <field name="eur2_invoice_amount"/>
                            <field name="eur2_rate" digits="[16,6]"/>
                            <field name="eur2_commission_percent"/>
                            <field name="eur2_usd_rate" digits="[16,6]"/>
                        </group>
                        <group string="Результаты расчетов">
                            <field name="eur2_final_rate_for_payment" readonly="1" digits="[16,6]"/>
                            <field name="eur2_payment_amount_rub" readonly="1" digits="[16,2]"/>
                            <field name="eur2_addon_usd"/>
                            <field name="eur2_addon_amount_rub" readonly="1" digits="[16,2]"/>
                            <field name="eur2_total_rub" readonly="1" digits="[16,2]"/>
                            <field name="eur2_final_rate_incl_addon" readonly="1" digits="[16,6]"/>
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Действие для калькулятора -->
    <record id="action_amanat_calculator_50_usd" model="ir.actions.act_window">
        <field name="name">Калькулятор сделок</field>
        <field name="res_model">amanat.calculator.50.usd.wizard</field>
        <field name="view_mode">form</field>
        <field name="view_id" ref="calculator_50_usd_form_view"/>
        <field name="target">current</field>
        <field name="context">{'default_date': context_today().strftime('%Y-%m-%d')}</field>
    </record>

    <!-- при необходимости добавь меню под свой модуль/меню-родителя -->
    <!--
    <menuitem id="menu_amanat_calculators_root" name="Калькуляторы"/>
    <menuitem id="menu_amanat_calculator_50_usd"
              name="Калькулятор сделок"
              parent="menu_amanat_calculators_root"
              action="action_amanat_calculator_50_usd"/>
    -->
</odoo>
