<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="amanat.AmanatDashboard" owl="1">
        <div class="o_amanat_dashboard o_action">
            <div class="o_amanat_dashboard_content">
                <t t-if="state.isLoading">
                    <div class="text-center py-5">
                        <i class="fa fa-spinner fa-spin fa-3x text-primary"/>
                        <p class="mt-3">Загрузка данных...</p>
                    </div>
                </t>

                <t t-else="">
                    <!-- Секция выбора диапазонов дат -->
                    <div class="date-range-selector mb-4">
                        <div class="row g-3 align-items-end">
                            <div class="col-lg-5">
                                <div class="date-range-group">
                                    <h6 class="mb-2">
                                        <i class="fa fa-calendar text-primary"/> Период 1 (Синий)
                                    </h6>
                                    <div class="row g-2">
                                        <div class="col-6">
                                            <label class="form-label small">От:</label>
                                            <input type="date" class="form-control form-control-sm" 
                                                   t-model="state.dateRange1.start"
                                                   t-on-change="onDateRange1Change"/>
                                        </div>
                                        <div class="col-6">
                                            <label class="form-label small">До:</label>
                                            <input type="date" class="form-control form-control-sm" 
                                                   t-model="state.dateRange1.end"
                                                   t-on-change="onDateRange1Change"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-5">
                                <div class="date-range-group">
                                    <h6 class="mb-2">
                                        <i class="fa fa-calendar text-danger"/> Период 2 Для сравнения (Красный)
                                    </h6>
                                    <div class="row g-2">
                                        <div class="col-6">
                                            <label class="form-label small">От:</label>
                                            <input type="date" class="form-control form-control-sm" 
                                                   t-model="state.dateRange2.start"
                                                   t-on-change="onDateRange2Change"/>
                                        </div>
                                        <div class="col-6">
                                            <label class="form-label small">До:</label>
                                            <input type="date" class="form-control form-control-sm" 
                                                   t-model="state.dateRange2.end"
                                                   t-on-change="onDateRange2Change"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-2">
                                <button class="btn btn-primary btn-sm w-100" t-on-click="applyDateRanges">
                                    <i class="fa fa-filter"/> Применить фильтры
                                </button>
                                <button class="btn btn-secondary btn-sm w-100 mt-2" t-on-click="resetDateRanges">
                                    <i class="fa fa-undo"/> Сбросить
                                </button>
                            </div>
                        </div>
                    </div>


                    <!-- Заявки в рамках диапазона (на всю ширину) -->
                    <div class="row g-3 mb-4">
                        <!-- Заявки в рамках диапазона (на всю ширину) -->
                        <div class="col-12">
                            <div class="stat-card zayavki-comparison-card clickable" t-on-click="openZayavki">
                                <div class="stat-header">
                                    <h5>Заявки в рамках диапазона</h5>
                                    <i class="fa fa-external-link-alt stat-link-icon"/>
                                </div>
                                <div class="stat-body">
                                    <div class="row">
                                        <!-- Левая колонка (Период 1) -->
                                        <div class="col-md-6">
                                            <div class="zayavki-period-box">
                                                <div class="stat-item">
                                                    <span class="stat-label">Количество заявок</span>
                                                    <span class="stat-value">
                                                        <t t-if="state.comparisonData and state.comparisonData.range1">
                                                            <t t-esc="formatNumber(state.comparisonData.range1.zayavki_count || 0)"/>
                                                        </t>
                                                        <t t-else="">
                                                            <t t-esc="formatNumber(state.zayavki.total)"/>
                                                        </t>
                                                    </span>
                                                </div>
                                                <div class="stat-item">
                                                    <span class="stat-label">Количество закрытых заявок</span>
                                                    <span class="stat-value">
                                                        <t t-if="state.comparisonData and state.comparisonData.range1">
                                                            <t t-esc="formatNumber(state.comparisonData.range1.zayavki_closed || 0)"/>
                                                        </t>
                                                        <t t-else="">
                                                            <t t-esc="formatNumber(state.zayavki.closed)"/>
                                                        </t>
                                                    </span>
                                                </div>
                                                <div class="stat-item">
                                                    <span class="stat-label">Сумма закрытых заявок</span>
                                                    <span class="stat-value">
                                                        <t t-if="state.comparisonData and state.comparisonData.range1">
                                                            <t t-esc="formatNumber(state.comparisonData.range1.zayavki_closed_amount || 0)"/>
                                                        </t>
                                                        <t t-else="">
                                                            <t t-esc="formatNumber(state.zayavki.closedAmount)"/>
                                                        </t>
                                                    </span>
                                                </div>
                                                <div class="stat-item">
                                                    <span class="stat-label">Эквивалент $ дата фиксации курса сегодня</span>
                                                    <span class="stat-value">
                                                        <t t-if="state.comparisonData and state.comparisonData.range1">
                                                            <t t-esc="formatNumber(state.comparisonData.range1.zayavki_usd_equivalent || 0)"/>
                                                        </t>
                                                        <t t-else="">
                                                            <t t-esc="formatNumber(state.zayavki.usdEquivalent || 0)"/>
                                                        </t>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Правая колонка (Период 2) -->
                                        <div class="col-md-6">
                                            <div class="zayavki-period-box">
                                                <div class="stat-item">
                                                    <span class="stat-label">Количество заявок</span>
                                                    <span class="stat-value">
                                                        <t t-if="state.comparisonData and state.comparisonData.range2">
                                                            <t t-esc="formatNumber(state.comparisonData.range2.zayavki_count || 0)"/>
                                                        </t>
                                                        <t t-else="">
                                                            <t t-esc="formatNumber(state.zayavki.total)"/>
                                                        </t>
                                                    </span>
                                                </div>
                                                <div class="stat-item">
                                                    <span class="stat-label">Количество закрытых заявок</span>
                                                    <span class="stat-value">
                                                        <t t-if="state.comparisonData and state.comparisonData.range2">
                                                            <t t-esc="formatNumber(state.comparisonData.range2.zayavki_closed || 0)"/>
                                                        </t>
                                                        <t t-else="">
                                                            <t t-esc="formatNumber(state.zayavki.closed)"/>
                                                        </t>
                                                    </span>
                                                </div>
                                                <div class="stat-item">
                                                    <span class="stat-label">Сумма закрытых заявок</span>
                                                    <span class="stat-value">
                                                        <t t-if="state.comparisonData and state.comparisonData.range2">
                                                            <t t-esc="formatNumber(state.comparisonData.range2.zayavki_closed_amount || 0)"/>
                                                        </t>
                                                        <t t-else="">
                                                            <t t-esc="formatNumber(state.zayavki.closedAmount)"/>
                                                        </t>
                                                    </span>
                                                </div>
                                                <div class="stat-item">
                                                    <span class="stat-label">Эквивалент $ дата фиксации курса сегодня</span>
                                                    <span class="stat-value">
                                                        <t t-if="state.comparisonData and state.comparisonData.range2">
                                                            <t t-esc="formatNumber(state.comparisonData.range2.zayavki_usd_equivalent || 0)"/>
                                                        </t>
                                                        <t t-else="">
                                                            <t t-esc="formatNumber(state.zayavki.usdEquivalent || 0)"/>
                                                        </t>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Соотношение ИМПОРТ/ЭКСПОРТ -->
                    <div class="row g-3 mb-4">
                        <div class="col-lg-6">
                            <div class="chart-card">
                                <h6 class="chart-title">
                                    <t t-if="state.comparisonData and state.comparisonData.range2">
                                        Период 1: Соотношение ИМПОРТ/ЭКСПОРТ
                                    </t>
                                    <t t-else="">
                                        Соотношение ИМПОРТ/ЭКСПОРТ
                                    </t>
                                </h6>
                                <div class="chart-container-medium">
                                    <canvas id="import-export-donut"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="chart-card">
                                <h6 class="chart-title">
                                    <t t-if="state.comparisonData and state.comparisonData.range2">
                                        Период 2: Соотношение ИМПОРТ/ЭКСПОРТ
                                    </t>
                                    <t t-else="">
                                        Соотношение ИМПОРТ/ЭКСПОРТ
                                    </t>
                                </h6>
                                <div class="chart-container-medium">
                                    <canvas id="import-export-donut-2"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Количество заявок под каждого контрагента -->
                    <div class="row g-3 mb-4">
                        <div class="col-12">
                            <div class="chart-card">
                                <h6 class="chart-title">Количество заявок под каждого контрагента</h6>
                                <div class="chart-container-large">
                                    <canvas id="contragents-by-zayavki-chart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Средний чек у Контрагента -->
                    <div class="row g-3 mb-4">
                        <div class="col-12">
                            <div class="chart-card">
                                <h6 class="chart-title">Средний чек у Контрагента</h6>
                                <div class="chart-container-large">
                                    <canvas id="contragent-avg-check-chart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Вознаграждение средний процент -->
                    <div class="row g-3 mb-4">
                        <div class="col-12">
                            <div class="chart-card">
                                <h6 class="chart-title">Вознаграждение средний процент</h6>
                                <div class="chart-container-large">
                                    <canvas id="contragent-reward-percent-chart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Количество заявок под каждого агента -->
                    <div class="row g-3 mb-4">
                        <div class="col-12">
                            <div class="chart-card">
                                <h6 class="chart-title">Количество заявок под каждого агента</h6>
                                <div class="chart-container-large">
                                    <canvas id="agents-by-zayavki-chart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Средняя сумма заявок под каждого агента -->
                    <div class="row g-3 mb-4">
                        <div class="col-12">
                            <div class="chart-card">
                                <h6 class="chart-title">Средняя сумма заявок под каждого агента</h6>
                                <div class="chart-container-large">
                                    <canvas id="agent-avg-amount-chart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Количество заявок под каждого клиента -->
                    <div class="row g-3 mb-4">
                        <div class="col-12">
                            <div class="chart-card">
                                <h6 class="chart-title">Количество заявок под каждого клиента</h6>
                                <div class="chart-container-large">
                                    <canvas id="clients-by-zayavki-chart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Количество заявок под каждого платежщика субагента -->
                    <div class="row g-3 mb-4">
                        <div class="col-12">
                            <div class="chart-card">
                                <h6 class="chart-title">Количество заявок под каждого платежщика субагента</h6>
                                <div class="chart-container-large">
                                    <canvas id="payers-by-zayavki-chart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Количество заявок под каждого субагента -->
                    <div class="row g-3 mb-4">
                        <div class="col-12">
                            <div class="chart-card">
                                <h6 class="chart-title">Количество заявок под каждого субагента</h6>
                                <div class="chart-container-large">
                                    <canvas id="subagents-by-zayavki-chart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Заявок закреплено за менеджером -->
                    <div class="row g-3 mb-4">
                        <div class="col-lg-6">
                            <div class="chart-card">
                                <h6 class="chart-title">
                                    <t t-if="state.comparisonData and state.comparisonData.range2">
                                        Период 1: Заявок закреплено за менеджером
                                    </t>
                                    <t t-else="">
                                        Заявок закреплено за менеджером
                                    </t>
                                </h6>
                                <div class="chart-container-medium">
                                    <canvas id="managers-by-zayavki-pie"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="chart-card">
                                <h6 class="chart-title">
                                    <t t-if="state.comparisonData and state.comparisonData.range2">
                                        Период 2: Заявок закреплено за менеджером
                                    </t>
                                    <t t-else="">
                                        Заявок закреплено за менеджером
                                    </t>
                                </h6>
                                <div class="chart-container-medium">
                                    <canvas id="managers-by-zayavki-pie-2"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Заявок закрыто менеджером -->
                    <div class="row g-3 mb-4">
                        <div class="col-lg-6">
                            <div class="chart-card">
                                <h6 class="chart-title">
                                    <t t-if="state.comparisonData and state.comparisonData.range2">
                                        Период 1: Заявок закрыто менеджером
                                    </t>
                                    <t t-else="">
                                        Заявок закрыто менеджером
                                    </t>
                                </h6>
                                <div class="chart-container-medium">
                                    <canvas id="managers-closed-zayavki-pie"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="chart-card">
                                <h6 class="chart-title">
                                    <t t-if="state.comparisonData and state.comparisonData.range2">
                                        Период 2: Заявок закрыто менеджером
                                    </t>
                                    <t t-else="">
                                        Заявок закрыто менеджером
                                    </t>
                                </h6>
                                <div class="chart-container-medium">
                                    <canvas id="managers-closed-zayavki-pie-2"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Эффективность менеджеров -->
                    <div class="row g-3 mb-4">
                        <div class="col-12">
                            <div class="chart-card">
                                <h6 class="chart-title">📊 Эффективность менеджеров</h6>
                                <div class="chart-container-large">
                                    <canvas id="managers-efficiency-chart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Статусы заявок -->
                    <div class="row g-3 mb-4">
                        <div class="col-lg-6">
                            <div class="chart-card">
                                <h6 class="chart-title">
                                    <t t-if="state.comparisonData and state.comparisonData.range2">
                                        Период 1: Статусы заявок
                                    </t>
                                    <t t-else="">
                                        Статусы заявок
                                    </t>
                                </h6>
                                <div class="chart-container-medium">
                                    <canvas id="zayavki-status-donut"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="chart-card">
                                <h6 class="chart-title">
                                    <t t-if="state.comparisonData and state.comparisonData.range2">
                                        Период 2: Статусы заявок
                                    </t>
                                    <t t-else="">
                                        Статусы заявок
                                    </t>
                                </h6>
                                <div class="chart-container-medium">
                                    <canvas id="zayavki-status-donut-2"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Средняя сумма заявок по клиентам -->
                    <div class="row g-3 mb-4">
                        <div class="col-12">
                            <div class="chart-card">
                                <h6 class="chart-title">Средняя сумма заявок по клиентам</h6>
                                <div class="chart-container-large">
                                    <canvas id="client-avg-amount-chart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>













                    <!-- Седьмой ряд - Циклы сделок -->
                    <div class="row g-3 mb-4">
                        <!-- Циклы сделок (линейный график) -->
                        <div class="col-lg-12">
                            <div class="chart-card">
                                <h6 class="chart-title">📈 Циклы сделок</h6>
                                <div class="chart-container-large">
                                    <canvas id="deal-cycles-line"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>


                </t>
            </div>
        </div>
    </t>
</templates> 