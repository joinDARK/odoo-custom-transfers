# Руководство пользователя - Генерация документа "Индивидуал"

## Введение

Функция генерации документа "Индивидуал" позволяет автоматически создавать индивидуальные поручения на основе данных заявки. Система автоматически переводит названия организаций на английский язык и поддерживает экспорт в форматах DOCX и PDF.

## Предварительные требования

### Системные требования
- Доступ к модулю "Заявки" в Odoo
- Права на создание и редактирование заявок
- Настроенная интеграция с YandexGPT (для переводов)

### Необходимые данные в заявке
Для корректной генерации документа убедитесь, что в заявке заполнены следующие поля:

**Обязательные поля:**
- Номер поручения (`instruction_number`)
- Дата подписания поручения (`instruction_signed_date`)
- Агент (`agent_id`)
- Клиент (`client_id`)

**Рекомендуемые поля:**
- Дата подписания агент-субагент (`agent_contract_date`)
- Покупатель/продавец (`exporter_importer_name`)
- Сумма (`amount`)
- Валюта (`currency`)
- Курс (`rate_field`)

**Банковские реквизиты:**
- Адрес получателя (`beneficiary_address`)
- Банк получателя (`beneficiary_bank_name`)
- Адрес банка получателя (`bank_address`)
- SWIFT код (`bank_swift`)

## Пошаговая инструкция

### Шаг 1: Открытие заявки
1. Перейдите в модуль **"Заявки"**
2. Откройте нужную заявку для редактирования
3. Убедитесь, что все необходимые поля заполнены

### Шаг 2: Переход к генерации документа
1. В форме заявки перейдите на вкладку **"Документы"**
2. Найдите раздел с полем **"assignment_end_attachments"** (поручение выход)
3. Под полем вы увидите две кнопки для генерации документа

### Шаг 3: Выбор формата и генерация
Выберите нужный формат документа:

**Для DOCX формата:**
- Нажмите кнопку **"Генерировать Индивидуал (DOCX)"** (зеленая кнопка)

**Для PDF формата:**
- Нажмите кнопку **"Генерировать Индивидуал (PDF)"** (синяя кнопка)

### Шаг 4: Ожидание результата
1. Система начнет обработку заявки
2. При необходимости будут выполнены переводы через YandexGPT
3. Документ будет сгенерирован в выбранном формате
4. После завершения появится уведомление об успешной генерации

### Шаг 5: Получение документа
1. Сгенерированный документ автоматически сохранится в поле **"assignment_end_attachments"**
2. Нажмите на название файла для скачивания
3. Документ готов к использованию

## Особенности работы системы

### Автоматический перевод
Система автоматически переводит следующие поля с русского на английский:

**Агент:**
- `{{агент}}` - остается на русском языке
- `{{agent}}` - переводится на английский

**Клиент:**
- `{{клиент}}` - остается на русском языке  
- `{{client}}` - переводится на английский

**Примеры переводов:**
- `ООО "Импекс-Ф"` → `Implex-F LLC`
- `АО "Сбербанк"` → `Sberbank JSC`
- `ТДК` → `TDK`
- `СТЕЛЛАР` → `STELLAR`

### Форматирование дат
Система поддерживает два формата дат:

**Русский формат (`{{подписано_п}}`):**
- Пример: `«18» Августа 2025`

**Английский формат (`{{order_s}}`):**
- Пример: `August 18, 2025`

### Обработка числовых значений
**Сумма (`{{сумма}}`):**
- Форматируется с 2 знаками после запятой
- Пример: `150000.00`

**Курс (`{{курс}}`):**
- Форматируется с 4 знаками после запятой
- Пример: `95.5000`

**Валюта (`{{валюта}}`):**
- Приводится к верхнему регистру
- Пример: `USD`, `EUR`, `RUB`

## Работа с таблицами в документе

### Двуязычные таблицы
Если в шаблоне есть таблица с колонками на русском и английском языках:
- Система автоматически заполнит обе колонки
- Структура таблицы сохранится
- Форматирование ячеек не изменится

### Сохранение структуры
- Все границы таблиц сохраняются
- Шрифты и стили остаются неизменными
- Размеры ячеек не изменяются

## Устранение неполадок

### Проблема: Документ не генерируется
**Возможные причины:**
1. Отсутствует шаблон "Индивидуал" в библиотеке шаблонов
2. Не заполнены обязательные поля в заявке
3. Проблемы с правами доступа

**Решение:**
1. Обратитесь к администратору для проверки наличия шаблона
2. Заполните все обязательные поля в заявке
3. Проверьте права доступа к модулю

### Проблема: Переводы не работают
**Возможные причины:**
1. Не настроена интеграция с YandexGPT
2. Проблемы с API ключами
3. Превышен лимит запросов к YandexGPT

**Решение:**
1. Обратитесь к администратору для проверки настроек YandexGPT
2. При ошибке перевода система использует оригинальный текст
3. Подождите и повторите попытку позже

### Проблема: PDF не создается
**Возможные причины:**
1. Не установлен LibreOffice на сервере
2. Проблемы с конвертацией DOCX в PDF

**Решение:**
1. Используйте формат DOCX вместо PDF
2. Обратитесь к администратору для установки LibreOffice

### Проблема: Пустые поля в документе
**Возможные причины:**
1. Не заполнены соответствующие поля в заявке
2. Неправильное сопоставление полей в шаблоне

**Решение:**
1. Проверьте заполнение всех полей в заявке
2. Убедитесь, что сигнатуры в шаблоне соответствуют документации

## Советы по эффективному использованию

### Подготовка данных
1. **Заполняйте все поля:** Чем больше данных заполнено в заявке, тем полнее будет документ
2. **Проверяйте даты:** Убедитесь, что даты указаны корректно
3. **Валидируйте банковские реквизиты:** Проверьте правильность SWIFT кодов и адресов

### Работа с переводами
1. **Стандартизируйте названия:** Используйте полные официальные названия организаций
2. **Проверяйте результат:** После генерации проверьте качество переводов
3. **Сообщайте об ошибках:** Если переводы неточные, сообщите администратору

### Оптимизация процесса
1. **Используйте шаблоны:** Создавайте заявки на основе существующих шаблонов
2. **Группируйте операции:** Генерируйте несколько документов подряд для экономии времени
3. **Сохраняйте копии:** Делайте резервные копии важных документов

## Часто задаваемые вопросы

**В: Можно ли изменить шаблон документа?**
О: Да, но это должен делать администратор системы через библиотеку шаблонов.

**В: Сколько времени занимает генерация документа?**
О: Обычно 10-30 секунд, в зависимости от сложности документа и скорости интернета.

**В: Можно ли генерировать документы массово?**
О: В текущей версии поддерживается только генерация по одному документу.

**В: Что делать, если перевод неточный?**
О: Система использует автоматический перевод. При необходимости можно отредактировать документ вручную после генерации.

**В: Сохраняется ли история генерации документов?**
О: Да, все сгенерированные документы сохраняются в поле "поручение выход" и доступны для просмотра.

## Контакты для поддержки

При возникновении проблем обращайтесь:
1. К администратору системы Odoo
2. В службу технической поддержки
3. К разработчикам модуля

Не забывайте указывать:
- Номер заявки
- Описание проблемы
- Скриншоты ошибок (если есть)
- Время возникновения проблемы
